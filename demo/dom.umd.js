!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(0,function(){function t(t,e){var n={};return n.type=t,n.props=e||{},n.children=[].concat.apply([],[].slice.call(arguments,2)),n.isComponent="function"==typeof t&&t.prototype&&"function"==typeof t.prototype.render,n.isStateless="function"==typeof t&&!n.isComponent,n.isDom="string"==typeof t,n}function e(t){this._parent=null,this._collector={refs:[],components:[]},this.props=t||{},this.base=null,this.mounted=!1}e.prototype.componentWillMount=function(){},e.prototype.render=function(){},e.prototype.componentDidMount=function(){},e.prototype.componentWillUnmount=function(){},e.prototype.registerComponent=function(t){t.render&&!~this._collector.components.indexOf(t)&&(t._parent=this,this._collector.components.push(t))},e.prototype.unregisterComponent=function(t){var e=this._collector.components.indexOf(t);t.render&&~e&&(t._parent=null,this._collector.components.splice(e,1))},e.prototype.destroy=function(){var t=0;for(t=this._collector.components.length-1;t>=0;t--)this._collector.components[t].destroy();for(this._parent&&this._parent.unregisterComponent(this),this.componentWillUnmount(this.props),this.mounted=!1,t=this._collector.refs.length-1;t>=0;t--)this._collector.refs[t].fn(null),this._collector.refs.splice(t,1);var e=Array.isArray(this.base)?this.base:[this.base];for(t=0;t<e.length;t++)e[t]&&e[t].parentNode&&e[t].parentNode.removeChild(e[t]);this.base=e=null,this.props=null};var n=["nodes","components","refs"];function o(){this.data={};for(var t=0;t<n.length;t++)this.data[n[t]]=[]}function r(t){var e;e=t,t=Array.isArray(e)?e:[e];for(var n=new o,r=0;r<t.length;r++)n.append(c(t[r]));return n.get()}function c(t){if(Array.isArray(t))return r(t);if(t instanceof window.Element)return function(t,e){var n=new o;return n.append({nodes:t}),n.get()}(t);if("object"!=typeof t)return function(t){var e=new o;return"string"!=typeof t&&"number"!=typeof t||e.append({nodes:document.createTextNode(t+"")}),e.get()}(t);var e=Object.assign({},t.props,{children:[].concat.apply([],t.children||[])});return t.isDom?function(t,e){for(var n=new o,r=[],i=0;i<e.children.length;i++){var s=c(e.children[i]);s.nodes&&(r=r.concat(s.nodes),n.append({components:s.components,refs:s.refs}))}var p,l,f,a,u=document.createElement(t.type);for(var d in t.props)p=u,f=t.props[d],a=void 0,"class"===(l=d)&&(l="className"),"function"==typeof f&&l.substr(0,(a="on").length)===a?p[l.slice(2).toLowerCase()]=f:"checked"===l||"value"===l||"className"===l?p[l]=f:"style"===l?"object"==typeof f?Object.assign(p.style,f):"string"==typeof f&&(p.style.cssText=f):"object"!=typeof f&&"function"!=typeof f&&p.setAttribute(l,f);for(i=0;i<r.length;i++)u.appendChild(r[i]);return e.ref&&n.append({refs:{ref:u,fn:e.ref}}),n.append({nodes:u}),n.get()}(t,e):t.isStateless?function(t,e){var n=new o,r=t.type(e);return n.append(c(r)),n.get()}(t,e):t.isComponent?function(t,e){var n=new o,r=new t.type(e);r.componentWillMount(e);var i=r.render(e);e.ref&&n.append({refs:{ref:r,fn:e.ref}}),n.append(c(i));var s=n.data.nodes;r.base=s.length>1?s:s[0],r._collector={},r._collector.components=n.data.components,r._collector.refs=n.data.refs,n.set({components:[r],refs:[]});for(var p=0;p<r._collector.components.length;p++)r._collector.components[p]._parent=r;return n.get()}(t,e):void 0}function i(t,e,n){var o=t._collector&&t._collector.components;if(n&&e(t),o)for(var r=0;r<o.length;r++)i(o[r],e);n||e(t)}function s(t){for(var e=0;e<t._collector.refs.length;e++)t._collector.refs[e].fn(t._collector.refs[e].ref),t._collector.refs[e].ref=null}function p(t,e,n){var o=c(t),r={_collector:o},p=o.nodes.length<2?o.nodes[0]:o.nodes;if("function"==typeof e?e(p):e&&e.appendChild(p),i(r,s),i(r,function(t){t.mounted=!0,t.componentDidMount&&t.componentDidMount(t.props)}),n&&n._collector){for(var l=n._collector,f=0;f<o.components.length;f++)o.components[f]._parent=n;l.refs&&(l.refs=l.refs.concat(o.refs)),l.components&&(l.components=l.components.concat(o.components))}return r=void 0,o}o.prototype.append=function(t){for(var e in t)this.data[e]=this.data[e].concat(t[e])},o.prototype.set=function(t){for(var e in t)this.data[e]=t[e]},o.prototype.get=function(){return this.data};var l=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.render=function(e){var n=this,o=e.count;return t("li",null,t("button",{ref:function(t){n.addButton=t}},"Add list"),t("button",{ref:function(t){n.removeButton=t}},"Remove item ",o))},n.prototype.remove=function(){this.destroy()},n.prototype.add=function(){var e=this;p(t(f,null),function(t){return e.base.appendChild(t)},this)},n.prototype.componentDidMount=function(){this.remove=this.remove.bind(this),this.add=this.add.bind(this),this.removeButton.addEventListener("click",this.remove),this.addButton.addEventListener("click",this.add)},n.prototype.componentWillUnmount=function(){this.removeButton.removeEventListener("click",this.remove),this.addButton.removeEventListener("click",this.add)},n}(e),f=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.render=function(e){var n=this;return t("div",null,t("ul",{ref:function(t){n.ul=t}}),t("button",{ref:function(t){n.button=t}},"Add item"))},n.prototype.componentDidMount=function(){this.count=0,this.addItem=this.addItem.bind(this),this.button.addEventListener("click",this.addItem)},n.prototype.addItem=function(){var e,n=this;console.log(this._collector),p(t(l,{count:++this.count,ref:(e="Item "+this.count,function(t){console.log(t?"Reference "+e:"De-reference "+e)})}),function(t){return n.ul.appendChild(t)},this)},n.prototype.componentWillUnmount=function(){this.button.removeEventListener("click",this.addItem)},n}(e),a=p(t(f,{name:"0 - "}),document.body);console.log(a)});
//# sourceMappingURL=dom.umd.js.map
