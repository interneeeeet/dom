!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(0,function(){function t(t,e){return function(n){t[e]=n}}function e(t,e){var n={};return n.type=t,n.props=e||{},n.children=[].concat.apply([],[].slice.call(arguments,2)),n.isComponent="function"==typeof t&&t.prototype&&"function"==typeof t.prototype.render,n.isStateless="function"==typeof t&&!n.isComponent,n.isDom="string"==typeof t,n}var n=["nodes","components","refs"];function o(){this.data={};for(var t=0;t<n.length;t++)this.data[n[t]]=[]}function r(t){if(Array.isArray(t))return function(t){e=t,t=Array.isArray(e)?e:[e];var e;for(var n=new o,i=0;i<t.length;i++)n.append(r(t[i]));return n.get()}(t);if(t instanceof window.Element)return function(t,e){var n=new o;return n.append({nodes:t}),n.get()}(t);if("object"!=typeof t)return function(t){var e=new o;"string"!=typeof t&&"number"!=typeof t||e.append({nodes:document.createTextNode(t+"")});return e.get()}(t);var e=Object.assign({},t.props,{children:[].concat.apply([],t.children||[])});return t.isDom?function(t,e){for(var n=new o,i=[],s=0;s<e.children.length;s++){var c=r(e.children[s]);c.nodes&&(i=i.concat(c.nodes),n.append({components:c.components,refs:c.refs}))}var p=document.createElement(t.type);for(var l in t.props)a=p,f=t.props[l],d=void 0,"class"===(u=l)&&(u="className"),"function"==typeof f&&u.substr(0,(d="on").length)===d?a[u.toLowerCase()]=f:"checked"===u||"value"===u||"className"===u?a[u]=f:"style"===u?"object"==typeof f?Object.assign(a.style,f):"string"==typeof f&&(a.style.cssText=f):"object"!=typeof f&&"function"!=typeof f&&a.setAttribute(u,f);var a,u,f,d;for(s=0;s<i.length;s++)p.appendChild(i[s]);e.ref&&n.append({refs:{ref:p,fn:e.ref}});return n.append({nodes:p}),n.get()}(t,e):t.isStateless?function(t,e){var n=new o,i=t.type(e);return n.append(r(i)),n.get()}(t,e):t.isComponent?function(t,e){var n=new o,i=new t.type(e);i.componentWillMount(e);var s=i.template(e);e.ref&&n.append({refs:{ref:i,fn:e.ref}});n.append(r(s));var c=n.data.nodes;i.base=c.length>1?c:c[0],i._collector={},i._collector.components=n.data.components,i._collector.refs=n.data.refs,n.set({components:[i],refs:[]});for(var p=0;p<i._collector.components.length;p++)i._collector.components[p]._parent=i;return n.get()}(t,e):void 0}function i(t,e,n){var o=t._collector&&t._collector.components;if(n&&e(t),o)for(var r=0;r<o.length;r++)i(o[r],e);n||e(t)}function s(t){for(var e=0;e<t._collector.refs.length;e++)t._collector.refs[e].fn(t._collector.refs[e].ref),t._collector.refs[e].ref=null}function c(t,e,n){var o=r(t),c=o.nodes.length<2?o.nodes[0]:o.nodes;"function"==typeof e?e(c):e&&e.appendChild(c);var p={_collector:o};if(i(p,s),i(p,function(t){t.mounted=!0,t.componentDidMount&&t.componentDidMount(t.props)}),n&&n._collector){for(var l=n._collector,a=0;a<o.components.length;a++)o.components[a]._parent=n;l.refs&&(l.refs=l.refs.concat(o.refs)),l.components&&(l.components=l.components.concat(o.components))}return p=void 0,o}function p(t){this._parent=null,this._collector={refs:[],components:[]},this.props=t||{},this.base=null,this.mounted=!1}function l(t){return e("button",{className:"btn",ref:t.ref},"Remove: ",t.children)}o.prototype.append=function(t){for(var e in t)this.data[e]=this.data[e].concat(t[e])},o.prototype.set=function(t){for(var e in t)this.data[e]=t[e]},o.prototype.get=function(){return this.data},p.prototype.template=function(){},p.prototype.componentWillMount=function(){},p.prototype.componentDidMount=function(){},p.prototype.componentWillUnmount=function(){},p.prototype.render=function(t,e){c(t,e,this)},p.prototype.destroy=function(){var t=0;for(this.componentWillUnmount(this.props),t=this._collector.components.length-1;t>=0;t--)this._collector.components[t].destroy();if(this.mounted=!1,this._parent){var e=this._parent._collector.components.indexOf(this);~e&&this._parent._collector.components.splice(e,1),this._parent=null}for(t=this._collector.refs.length-1;t>=0;t--)this._collector.refs[t].fn(null),this._collector.refs.splice(t,1);var n=Array.isArray(this.base)?this.base:[this.base];for(t=0;t<n.length;t++)n[t]&&n[t].parentNode&&n[t].parentNode.removeChild(n[t]);this.base=n=null,this.props={}};var a=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.template=function(){return e("span",null)},n.prototype.increment=function(){this.base.textContent=" Alive since "+this.count+++"sec",console.log("increment")},n.prototype.componentDidMount=function(){this.count=0,this.increment=this.increment.bind(this),this.increment(),this.timer=window.setInterval(this.increment,1e3)},n.prototype.componentWillUnmount=function(){clearInterval(this.timer)},n}(p),u=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.template=function(n){var o=n.count;return e("li",null,e("button",{className:"btn primary",ref:t(this,"addButton")},"Add list"),e(l,{ref:t(this,"removeButton")},"item ",o),e(a,null))},o.prototype.addList=function(){this.render(e(f,null),this.base)},o.prototype.componentDidMount=function(){this.destroy=this.destroy.bind(this),this.addList=this.addList.bind(this),this.removeButton.addEventListener("click",this.destroy),this.addButton.addEventListener("click",this.addList)},o.prototype.componentWillUnmount=function(){console.log("remove",this.props.count),this.removeButton.removeEventListener("click",this.destroy),this.addButton.removeEventListener("click",this.addList)},o}(p),f=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.template=function(){return e("div",{style:"border-left: 2px solid black; padding-left: 10px"},e("ul",{ref:t(this,"ul")}),e("button",{className:"btn primary",ref:t(this,"button")},"Add item"))},o.prototype.componentDidMount=function(){this.count=0,this.addItem=this.addItem.bind(this),this.button.addEventListener("click",this.addItem)},o.prototype.addItem=function(){this.render(e(u,{count:++this.count}),this.ul)},o.prototype.componentWillUnmount=function(){this.button.removeEventListener("click",this.addItem)},o}(p);c(e(function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.template=function(){return document.querySelector("main")},n.prototype.componentDidMount=function(){var t=this;this.base.style.paddingTop="20px",this.render(e(f,null),this.base),this.base.addEventListener("click",function(){console.log(t)})},n}(p),null))});
//# sourceMappingURL=dom.umd.js.map
